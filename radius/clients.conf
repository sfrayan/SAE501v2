#
# clients.conf - Configuration des clients RADIUS (NAS)
#
# Fichier: radius/clients.conf
# Auteur: GroupeNani
# Date: 2 février 2026
# Version: 2.2 - Correction client VM + simplification secrets
#
# Description:
#   Définit les clients RADIUS autorisés (Routeurs/NAS) qui peuvent
#   communiquer avec le serveur FreeRADIUS.
#
# Utilisation:
#   À copier vers: /etc/freeradius/3.0/clients.conf
#

#############################################################################
# CLIENT: localhost (Pour tests locaux et radtest)
#############################################################################
client localhost {
    # Adresse IP de loopback
    ipaddr    = 127.0.0.1
    shortname = localhost

    # Secret pour les tests locaux (radtest)
    secret    = testing123

    proto     = udp
    require_message_authenticator = no
}

#############################################################################
# CLIENT: VM RADIUS (192.168.10.100) - Pour tests locaux sur IP réelle
#############################################################################
client 192.168.10.100 {
    # Adresse IP de la VM elle-même
    ipaddr    = 192.168.10.100
    shortname = VM-RADIUS-LOCAL

    # Secret pour les tests locaux
    secret    = testing123

    proto     = udp
    require_message_authenticator = no
    nas_type  = other
}

#############################################################################
# CLIENT: TL-MR100 - Routeur Principal
#############################################################################
client 192.168.10.1 {
    # Adresse IP du routeur TP-Link
    ipaddr  = 192.168.10.1

    # Nom du client (pour la documentation)
    shortname = TL-MR100
    
    # Secret partagé entre routeur et serveur
    # ⚠️ IMPORTANT: Doit être identique dans la config du routeur
    # Version simplifiée pour tests (CHANGER EN PRODUCTION !)
    secret = testing123

    # Protocole utilisé
    proto = udp
    
    # Options supplémentaires
    # Accepter les paquets fragmentés
    require_message_authenticator = no
    
    # Type de NAS
    nas_type = other
}

#############################################################################
# NOTES DE CONFIGURATION
#############################################################################
#
# ARCHITECTURE RÉSEAU (Simplifiée - Pas de VLAN):
#
#   Réseau unique: 192.168.10.0/24
#   ├─ Routeur TP-Link TL-MR100: 192.168.10.1
#   ├─ Serveur RADIUS: 192.168.10.100 (Bridge LAN) + NAT (WiFi)
#   └─ Clients Wi-Fi: 192.168.10.2-99 (DHCP)
#
#   SSID 1: "Fitness-Pro" (WPA2-Enterprise + RADIUS)
#   SSID 2: "Fitness-Guest" (WPA2-PSK)
#
# SERVEUR - 2 CARTES RÉSEAU:
#   - enp0s8 (Bridge): 192.168.10.100 → Communication avec routeur TP-Link
#   - enp0s3 (NAT): Internet pour apt-get
#
# SECRET PARTAGÉ:
#   - ACTUELLEMENT: testing123 (pour tests)
#   - PRODUCTION: Générer avec: openssl rand -hex 16
#   - Doit être IDENTIQUE dans clients.conf ET config routeur
#
# IP CLIENTS:
#   - 127.0.0.1: Tests locaux (radtest)
#   - 192.168.10.100: Tests sur IP réelle de la VM
#   - 192.168.10.1: Routeur TP-Link (production)
#
# FLUX AUTHENTIFICATION:
#   Client Wi-Fi → Routeur (192.168.10.1) → Serveur RADIUS (192.168.10.100:1812)
#   Le routeur doit être dans cette liste pour être accepté
#
# DÉPANNAGE:
#   Si erreur "unknown client X.X.X.X":
#   1. Vérifier que l'IP est dans ce fichier
#   2. Vérifier que le secret correspond
#   3. Redémarrer FreeRADIUS: systemctl restart freeradius
#   4. Vérifier logs: tail -f /var/log/freeradius/radius.log
#
#############################################################################
