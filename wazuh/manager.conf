<!-- 
  manager.conf - Configuration Wazuh Manager (v1.5)
  
  Fichier: wazuh/manager.conf
  Auteur: GroupeNani
  Date: 31 janvier 2026
  Version: 1.5 (ajout PHP-Admin + rsyslog config)
  
  Description:
    Configuration du manager Wazuh pour la surveillance sécurité SAE 5.01.
    À copier vers: /var/ossec/etc/ossec.conf
    
  Nouveautés v1.5:
    - Ajout surveillance /var/log/php-admin.log
    - Configuration rsyslog incluse (voir ci-dessous)
    - Support complet PHP-Admin + FreeRADIUS
    
  Configuration rsyslog requise:
    Créer /etc/rsyslog.d/20-php-admin.conf avec:
    :programname, isequal, "php-admin" /var/log/php-admin.log
    & stop
    
    Puis:
    sudo touch /var/log/php-admin.log
    sudo chown syslog:adm /var/log/php-admin.log
    sudo chmod 640 /var/log/php-admin.log
    sudo systemctl restart rsyslog
-->

<ossec_config>
  <!-- ============================================
       CONFIGURATION GLOBALE
       ============================================ -->
  <global>
    <email_notification>no</email_notification>
    <logall>yes</logall>
    <logall_json>yes</logall_json>
  </global>

  <!-- ============================================
       ALERTES
       ============================================ -->
  <alerts>
    <log_alert_level>3</log_alert_level>
  </alerts>

  <!-- ============================================
       LOCALFILE - COLLECTE FICHIERS LOGS
       ============================================ -->
  
  <!-- Logs système -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/syslog</location>
  </localfile>

  <!-- PHP-Admin - Actions utilisateurs RADIUS -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/php-admin.log</location>
  </localfile>

  <!-- FreeRADIUS - Authentifications WiFi -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/freeradius/radius.log</location>
  </localfile>

  <!-- ============================================
       INTÉGRITÉ FICHIERS
       ============================================ -->
  <syscheck>
    <frequency>86400</frequency>
    <directories check_all="yes">/etc/ssh</directories>
    <directories check_all="yes">/etc/freeradius</directories>
    <directories check_all="yes">/var/www/html/php-admin</directories>
    <ignore>/var/ossec/logs</ignore>
    <ignore>/var/log</ignore>
  </syscheck>

  <!-- ============================================
       RÉCEPTION SYSLOG (Routeur TL-MR100)
       ============================================ -->
  <remote>
    <connection>syslog</connection>
    <port>514</port>
    <protocol>udp</protocol>
    <allowed-ips>192.168.10.0/24</allowed-ips>
    <allowed-ips>192.168.20.0/24</allowed-ips>
  </remote>

  <!-- ============================================
       CONNEXION AGENTS
       ============================================ -->
  <remote>
    <connection>secure</connection>
    <port>1514</port>
    <protocol>tcp</protocol>
    <allowed-ips>192.168.10.0/24</allowed-ips>
    <allowed-ips>192.168.20.0/24</allowed-ips>
  </remote>

  <!-- ============================================
       MODULES WAZUH (MINIMAUX)
       ============================================ -->
  
  <wodle name="vulnerability-detector">
    <disabled>yes</disabled>
  </wodle>

  <wodle name="syscollector">
    <disabled>yes</disabled>
  </wodle>

  <wodle name="osquery">
    <disabled>yes</disabled>
  </wodle>

  <!-- ============================================
       DÉCODERS & RÈGLES
       ============================================ -->
  <ruleset>
    <decoder_dir>ruleset/decoders</decoder_dir>
    <rule_dir>ruleset/rules</rule_dir>
    <rule_include>local_rules.xml</rule_include>
  </ruleset>

</ossec_config>