<!-- 
  manager.conf - Configuration Wazuh Manager
  
  Fichier: wazuh/manager.conf
  Auteur: GroupeNani
  Date: 11 janvier 2026
  
  Description:
    Configuration du manager Wazuh pour la surveillance sécurité SAE 5.01.
    À copier vers: /var/ossec/etc/ossec.conf
    
  Fonctionnalités:
    - Collecte logs FreeRADIUS (1812-1813 UDP)
    - Collecte logs système (syslog)
    - Collecte logs authentification SSH/sudo
    - Détection intrusions (HIDS)
    - Alertes sécurité sur événements critiques
-->

<ossec_config>
  <!-- ============================================
       CONFIGURATION GLOBALE
       ============================================ -->
  <global>
    <!-- Email notifications (optionnel) -->
    <email_notification>no</email_notification>
    <smtp_server>localhost</smtp_server>
    <email_from>wazuh@gym.fr</email_from>
    <email_to>admin@gym.fr</email_to>
    
    <!-- Logs manager -->
    <logall>yes</logall>
  </global>

  <!-- ============================================
       ALERTES & RÈGLES
       ============================================ -->
  <alerts>
    <!-- Niveau minimal d’alerte envoyé aux sorties -->
    <log_alert_level>3</log_alert_level>
  </alerts>

  <!-- ============================================
       LOCALFILE - COLLECTE FICHIERS LOGS
       ============================================ -->
  
  <!-- FreeRADIUS Main Log -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/freeradius/radius.log</location>
    <label key="@source">freeradius-main</label>
  </localfile>

  <!-- FreeRADIUS Accounting -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/freeradius/radacct.log</location>
    <label key="@source">freeradius-accounting</label>
  </localfile>

  <!-- SSH Authentication -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
    <label key="@source">ssh-auth</label>
  </localfile>

  <!-- System Logs -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/syslog</location>
    <label key="@source">system-logs</label>
  </localfile>

  <!-- Sudo Actions -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
    <label key="@source">sudo-logs</label>
  </localfile>

  <!-- Apache/Web Server (si présent) -->
  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/apache2/access.log</location>
    <label key="@source">apache-access</label>
  </localfile>

  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/apache2/error.log</location>
    <label key="@source">apache-error</label>
  </localfile>

  <!-- MySQL/MariaDB (si présent) -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/mysql/error.log</location>
    <label key="@source">mysql-error</label>
  </localfile>

  <!-- ============================================
       INTÉGRITÉ FICHIERS (File Integrity Monitoring)
       ============================================ -->
  <syscheck>
    <!-- Fréquence scan (secondes) -->
    <frequency>43200</frequency>
    
    <!-- Dossiers critiques à surveiller -->
    <directories check_all="yes">/etc/freeradius/3.0</directories>
    <directories check_all="yes">/var/www/html/php-admin</directories>
    <directories check_all="yes">/etc/ssh</directories>
    <directories check_all="yes">/root/.ssh</directories>
    
    <!-- Ignorer certains fichiers -->
    <ignore>/var/ossec/logs</ignore>
    <ignore>/var/log</ignore>
    
  </syscheck>

  <!-- ============================================
       ROOTKIT DETECTION
       ============================================ -->
  <rootcheck>
    <disabled>no</disabled>
    <check_files>yes</check_files>
    <check_dev>yes</check_dev>
    <check_sys>yes</check_sys>
    <check_pids>yes</check_pids>
    <check_ports>yes</check_ports>
    <check_if>yes</check_if>
  </rootcheck>

  <!-- ============================================
       AGENT COMMUNICATION
       ============================================ -->
  <client>
    <!-- IP du Manager (si agents distants) -->
    <server-ip>192.168.10.254</server-ip>
    <port>1514</port>
    <protocol>tcp</protocol>
    
    <!-- Auto-update (yes/no) -->
    <auto_restart>yes</auto_restart>
  </client>

  <!-- ============================================
       AGENT DISTANTS - CONNEXIONS ENTRANTES
       ============================================ -->
  <remote>
    <connection>secure</connection>
    <port>1514</port>
    <protocol>tcp</protocol>

    <allowed-ips>192.168.10.0/24</allowed-ips>
    <allowed-ips>192.168.20.0/24</allowed-ips>
    <allowed-ips>127.0.0.1</allowed-ips>
  </remote>

  <!-- ============================================
       MONITORING DES PROCESSUS CRITIQUES
       ============================================ -->
  <localfile>
    <log_format>full_command</log_format>
    <alias>process_monitoring</alias>
    <!-- Liste les processus critiques toutes les 60s -->
    <command>ps -C freeradius,sshd,mysqld,apache2 -o comm=</command>
    <frequency>60</frequency>
  </localfile>

  <!-- ============================================
       DÉCODERS & RÈGLES PERSONNALISÉES SAE 5.01
       ============================================ -->
  <ruleset>
    <!-- Règles par défaut Wazuh -->
    <decoder_dir>ruleset/decoders</decoder_dir>
    <rule_dir>ruleset/rules</rule_dir>

    <!-- Règles personnalisées du projet -->
    <rule_include>etc/rules/local_rules.xml</rule_include>
    <rule_include>etc/rules/freeradius_rules.xml</rule_include>
    <rule_include>etc/rules/ssh_rules.xml</rule_include>
    <rule_include>etc/rules/syslog_rules.xml</rule_include>
  </ruleset>

  <!-- ============================================
       DATABASE SETTINGS (optionnel)
       ============================================ -->
  
  <!-- Alert database (MySQL) - optionnel -->
  <!-- <database_output>
    <enabled>yes</enabled>
    <type>mysql</type>
    <hostname>localhost</hostname>
    <username>wazuh_user</username>
    <password>WazuhPass!2026</password>
    <database>wazuh</database>
  </database_output> -->

  <!-- ============================================
       NOTES SÉCURITÉ
       ============================================ -->
  <!--
    Configuration Wazuh pour SAE 5.01
    
    Services surveillés:
    ✓ FreeRADIUS (authentification WiFi)
    ✓ SSH (accès administrateur)
    ✓ MySQL/MariaDB (base RADIUS)
    ✓ Apache/PHP-Admin (interface gestion)
    ✓ Système d'exploitation
    
    Types de détection:
    ✓ Intrusions (port scans, bruteforce)
    ✓ Malwares (rootkits, trojans)
    ✓ Anomalies (logs suspects, fichiers modifiés)
    ✓ Violations de sécurité (sudo, changements fichiers)
    
    Alertes configurées:
    - SSH bruteforce (5+ échecs en 5 min)
    - Tentatives escalade de privilèges (sudo)
    - Modifications fichiers critiques (intégrité)
    - Arrêt services critiques (FreeRADIUS, SSH)
    - Erreurs authentification RADIUS (5+ par minute)
    
    En production:
    1. Configurer email notifications
    2. Activer base de données MySQL (stockage long terme)
    3. Configurer agents distants sur sites secondaires
    4. Intégrer avec SIEM (Splunk, ELK, etc.)
    5. Mettre en place alerting automatique
    6. Archiver logs régulièrement
  -->

</ossec_config>
