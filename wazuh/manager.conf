<!-- 
  manager.conf - Configuration Wazuh Manager (CORRIGÉ v1.3)
  
  Fichier: wazuh/manager.conf
  Auteur: GroupeNani
  Date: 31 janvier 2026
  Version: 1.3 (ajout wodles)
  
  Description:
    Configuration du manager Wazuh pour la surveillance sécurité SAE 5.01.
    À copier vers: /var/ossec/etc/ossec.conf
    
  Corrections v1.3:
    - Ajout configuration wodles (modules Wazuh)
    - Fix InventoryHarvesterFacade error
-->

<ossec_config>
  <!-- ============================================
       CONFIGURATION GLOBALE
       ============================================ -->
  <global>
    <!-- Email notifications (optionnel) -->
    <email_notification>no</email_notification>
    <smtp_server>localhost</smtp_server>
    <email_from>wazuh@gym.fr</email_from>
    <email_to>admin@gym.fr</email_to>
    
    <!-- Logs manager -->
    <logall>yes</logall>
    <logall_json>yes</logall_json>
  </global>

  <!-- ============================================
       ALERTES & RÈGLES
       ============================================ -->
  <alerts>
    <!-- Niveau minimal d'alerte envoyé aux sorties -->
    <log_alert_level>3</log_alert_level>
    <email_alert_level>7</email_alert_level>
  </alerts>

  <!-- ============================================
       LOCALFILE - COLLECTE FICHIERS LOGS
       ============================================ -->
  
  <!-- FreeRADIUS Main Log -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/freeradius/radius.log</location>
  </localfile>

  <!-- SSH Authentication -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
  </localfile>

  <!-- System Logs -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/syslog</location>
  </localfile>

  <!-- Apache Access Log (si installé) -->
  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/apache2/access.log</location>
  </localfile>

  <!-- Apache Error Log -->
  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/apache2/error.log</location>
  </localfile>

  <!-- ============================================
       INTÉGRITÉ FICHIERS (File Integrity Monitoring)
       ============================================ -->
  <syscheck>
    <!-- Fréquence scan (secondes) - 12h -->
    <frequency>43200</frequency>
    
    <!-- Dossiers critiques à surveiller -->
    <directories check_all="yes">/etc/freeradius/3.0</directories>
    <directories check_all="yes">/var/www/html/php-admin</directories>
    <directories check_all="yes">/etc/ssh</directories>
    
    <!-- Ignorer certains fichiers -->
    <ignore>/var/ossec/logs</ignore>
    <ignore>/var/log</ignore>
  </syscheck>

  <!-- ============================================
       ROOTKIT DETECTION
       ============================================ -->
  <rootcheck>
    <disabled>no</disabled>
    <check_files>yes</check_files>
    <check_dev>yes</check_dev>
    <check_sys>yes</check_sys>
    <check_pids>yes</check_pids>
    <check_ports>yes</check_ports>
    <check_if>yes</check_if>
  </rootcheck>

  <!-- ============================================
       RÉCEPTION SYSLOG - TL-MR100 & RADIUS
       ============================================ -->
  <remote>
    <connection>syslog</connection>
    <port>514</port>
    <protocol>udp</protocol>
    <allowed-ips>192.168.10.0/24</allowed-ips>
    <allowed-ips>192.168.20.0/24</allowed-ips>
  </remote>

  <!-- Connexion agents (si agents distants) -->
  <remote>
    <connection>secure</connection>
    <port>1514</port>
    <protocol>tcp</protocol>
    <allowed-ips>192.168.10.0/24</allowed-ips>
    <allowed-ips>192.168.20.0/24</allowed-ips>
  </remote>

  <!-- ============================================
       MODULES WAZUH (WODLES)
       ============================================ -->
  
  <!-- Vulnerability Detector -->
  <wodle name="vulnerability-detector">
    <disabled>yes</disabled>
  </wodle>

  <!-- OpenSCAP -->
  <wodle name="open-scap">
    <disabled>yes</disabled>
  </wodle>

  <!-- CIS-CAT -->
  <wodle name="cis-cat">
    <disabled>yes</disabled>
  </wodle>

  <!-- Osquery -->
  <wodle name="osquery">
    <disabled>yes</disabled>
  </wodle>

  <!-- Syscollector -->
  <wodle name="syscollector">
    <disabled>no</disabled>
    <interval>1h</interval>
    <scan_on_start>yes</scan_on_start>
    <hardware>yes</hardware>
    <os>yes</os>
    <network>yes</network>
    <packages>yes</packages>
    <ports all="no">yes</ports>
    <processes>yes</processes>
  </wodle>

  <!-- SCA (Security Configuration Assessment) -->
  <sca>
    <enabled>yes</enabled>
    <scan_on_start>yes</scan_on_start>
    <interval>12h</interval>
    <skip_nfs>yes</skip_nfs>
  </sca>

  <!-- ============================================
       DÉCODERS & RÈGLES PERSONNALISÉES SAE 5.01
       ============================================ -->
  <ruleset>
    <!-- Règles par défaut Wazuh -->
    <decoder_dir>ruleset/decoders</decoder_dir>
    <rule_dir>ruleset/rules</rule_dir>

    <!-- Décodeur personnalisé TL-MR100 -->
    <decoder>decoders/syslog-tlmr100.xml</decoder>

    <!-- Règles personnalisées du projet -->
    <rule_include>local_rules.xml</rule_include>
  </ruleset>

  <!-- ============================================
       NOTES & CHANGELOG
       ============================================ -->
  <!--
    Configuration Wazuh pour SAE 5.01
    
    Services surveillés:
    ✓ FreeRADIUS (authentification WiFi)
    ✓ SSH (accès administrateur)
    ✓ Apache/PHP-Admin (interface gestion)
    ✓ Système d'exploitation
    ✓ TL-MR100 (routeur WiFi via syslog)
    
    Types de détection:
    ✓ Intrusions (port scans, bruteforce)
    ✓ Malwares (rootkits)
    ✓ Anomalies (logs suspects, fichiers modifiés)
    ✓ Violations de sécurité (sudo, changements fichiers)
    
    CHANGELOG:
    v1.3 (31 janvier 2026):
    - AJOUTÉ: Configuration wodles (modules Wazuh)
    - AJOUTÉ: syscollector (inventory hardware/os/network)
    - AJOUTÉ: SCA (Security Configuration Assessment)
    - DÉSACTIVÉ: vulnerability-detector, open-scap, cis-cat, osquery
    - FIX: InventoryHarvesterFacade error
    
    v1.2 (31 janvier 2026):
    - SUPPRIMÉ: localfile radacct.log (optionnel)
    - SUPPRIMÉ: localfile mysql/error.log (emplacement variable)
    - SUPPRIMÉ: section full_command (obsolète Wazuh 4.x)
    - AJOUTÉ: remote syslog port 514 UDP
    - AJOUTÉ: decoder syslog-tlmr100.xml
    - CORRIGÉ: chemins conformes Wazuh 4.x
    
    v1.1 (31 janvier 2026):
    - SUPPRIMÉ: Section <client>
    - SUPPRIMÉ: règles inexistantes
    - CONSERVÉ: local_rules.xml uniquement
  -->

</ossec_config>